<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Detección de Objetos</title>
    <link rel="stylesheet" href="style.css" />
    <script>
        window.API_BASE = window.location.origin;
    </script>
</head>

<body>
    <div class="api-settings">
        <button id="btnOpenApiSettings" class="api-toggle" title="Configurar IP/URL de la API">Ajustes API</button>
        <div id="apiSettingsPanel" class="api-settings-panel hidden" role="dialog" aria-label="Ajustes de la API">
            <label for="apiBaseInput">Base URL API:</label>
            <input type="text" id="apiBaseInput" placeholder="http://127.0.0.1:5501" />
            <div class="api-settings-actions">
                <button id="btnSaveApiBase" class="api-action">Guardar</button>
                <button id="btnResetApiBase" class="api-action">Restablecer</button>
            </div>
            <div id="apiSettingsNote" class="api-settings-note margin-top-8"></div>
        </div>
        <div id="apiBackdrop" class="api-backdrop hidden" tabindex="-1" aria-hidden="true"></div>
    </div>
    <div class="tabs" role="tablist" aria-label="Selector de fuente">
        <button id="tabbtn-image" class="tabbtn active" data-tab="tab-image" role="tab" aria-controls="tab-image"
            aria-selected="true">Imagen</button>
        <button id="tabbtn-video" class="tabbtn" data-tab="tab-video" role="tab" aria-controls="tab-video"
            aria-selected="false">Video</button>
        <button id="tabbtn-camera" class="tabbtn" data-tab="tab-camera" role="tab" aria-controls="tab-camera"
            aria-selected="false">Cámara</button>
    </div>
    <main>
        <div class="left">
            <section id="tab-image" class="tab-panel active" role="tabpanel" aria-labelledby="tabbtn-image">
                <div id="imageControls">
                    <div class="margin-top-8">
                        <label for="fileInput">Selecciona una imagen:</label>
                        <input type="file" id="fileInput" accept="image/*" title="Selecciona una imagen para detectar"
                            placeholder="Selecciona una imagen" />
                    </div>
                    <div class="margin-top-8">
                        <label for="classSelect_image" class="classLabel" id="classLabel_image">Clase:</label>
                        <select id="classSelect_image" class="classSelect">
                            <option value="all">Todas</option>
                            <option value="persona">persona</option>
                            <option value="bicicleta">bicicleta</option>
                            <option value="automovil">automovil</option>
                            <option value="motocicleta">motocicleta</option>
                            <option value="avion">avion</option>
                            <option value="autobus">autobus</option>
                            <option value="tren">tren</option>
                            <option value="camion">camion</option>
                            <option value="barco">barco</option>
                            <option value="semaforo">semaforo</option>
                            <option value="boca de incendio">boca de incendio</option>
                            <option value="street sign">street sign</option>
                            <option value="señal de alto">señal de alto</option>
                            <option value="parquimetro">parquimetro</option>
                            <option value="banco">banco</option>
                            <option value="pájaro">pájaro</option>
                            <option value="gato">gato</option>
                            <option value="perro">perro</option>
                            <option value="caballo">caballo</option>
                            <option value="oveja">oveja</option>
                            <option value="vaca">vaca</option>
                            <option value="elefante">elefante</option>
                            <option value="oso">oso</option>
                            <option value="zebra">zebra</option>
                            <option value="girafa">girafa</option>
                            <option value="sombrero">sombrero</option>
                            <option value="mochila">mochila</option>
                            <option value="paraguas">paraguas</option>
                            <option value="zapato">zapato</option>
                            <option value="lentes">lentes</option>
                            <option value="bolso de mano">bolso de mano</option>
                            <option value="tie">tie</option>
                            <option value="maleta">maleta</option>
                            <option value="disco volador">disco volador</option>
                            <option value="esquís">esquís</option>
                            <option value="patineta de nieve">patineta de nieve</option>
                            <option value="pelota de deportes">pelota de deportes</option>
                            <option value="cometa">cometa</option>
                            <option value="bat de béisbol">bat de béisbol</option>
                            <option value="guante de béisbol">guante de béisbol</option>
                            <option value="patineta">patineta</option>
                            <option value="tabla de surf">tabla de surf</option>
                            <option value="raqueta de tennis">raqueta de tennis</option>
                            <option value="botella">botella</option>
                            <option value="lámina">lámina</option>
                            <option value="copa de vino">copa de vino</option>
                            <option value="taza">taza</option>
                            <option value="tenedor">tenedor</option>
                            <option value="cuchillo">cuchillo</option>
                            <option value="cuchara">cuchara</option>
                            <option value="bol">bol</option>
                            <option value="platano">platano</option>
                            <option value="manzana">manzana</option>
                            <option value="sandwich">sandwich</option>
                            <option value="naranja">naranja</option>
                            <option value="brocoli">brocoli</option>
                            <option value="zanahoria">zanahoria</option>
                            <option value="hot dog">hot dog</option>
                            <option value="pizza">pizza</option>
                            <option value="dona">dona</option>
                            <option value="pastel">pastel</option>
                            <option value="silla">silla</option>
                            <option value="sofá">sofá</option>
                            <option value="planta en maceta">planta en maceta</option>
                            <option value="cama">cama</option>
                            <option value="espejo">espejo</option>
                            <option value="comedor">comedor</option>
                            <option value="ventana">ventana</option>
                            <option value="escritorio">escritorio</option>
                            <option value="baño">baño</option>
                            <option value="puerta">puerta</option>
                            <option value="televisión">televisión</option>
                            <option value="laptop">laptop</option>
                            <option value="mouse">mouse</option>
                            <option value="remoto">remoto</option>
                            <option value="teclado">teclado</option>
                            <option value="celular">celular</option>
                            <option value="microondas">microondas</option>
                            <option value="horno">horno</option>
                            <option value="tostador">tostador</option>
                            <option value="sink">sink</option>
                            <option value="refrigerador">refrigerador</option>
                            <option value="licuadora">licuadora</option>
                            <option value="libro">libro</option>
                            <option value="reloj">reloj</option>
                            <option value="florero">florero</option>
                            <option value="tijeras">tijeras</option>
                            <option value="oso de peluche">oso de peluche</option>
                            <option value="secador de pelo">secador de pelo</option>
                            <option value="cepillo de dientes">cepillo de dientes</option>
                            <option value="cepillo de pelo">cepillo de pelo</option>
                        </select>
                        <label for="conf_image" title="SSD MobileNet v2: 0.3-0.6 (recomendado: 0.4)">Umbral:</label>
                        <br>
                        <input type="number" id="conf_image" value="0.4" min="0" max="1" step="0.05" />
                        <button id="btnDetectImage">Detectar Imagen</button>
                    </div>
                    <div class="margin-top-8">
                        <h4>Detecciones:</h4>
                        <div id="log_image" class="detection-log">(sin datos)</div>
                    </div>
                    <div id="status_image" class="status margin-top-8" aria-live="polite"></div>
            </section>

            <section id="tab-video" class="tab-panel" role="tabpanel" aria-labelledby="tabbtn-video">
                <div id="videoControls">
                    <label for="videoFile">Subir video (mp4):</label>
                    <input type="file" id="videoFile" accept="video/*" />
                </div>
                <div class="margin-top-8">
                    <label for="classSelect_video" class="classLabel" id="classLabel_video">Clase:</label>
                    <select id="classSelect_video" class="classSelect">
                        <option value="all">Todas</option>
                        <option value="persona">persona</option>
                        <option value="bicicleta">bicicleta</option>
                        <option value="automovil">automovil</option>
                        <option value="motocicleta">motocicleta</option>
                        <option value="avion">avion</option>
                        <option value="autobus">autobus</option>
                        <option value="tren">tren</option>
                        <option value="camion">camion</option>
                        <option value="barco">barco</option>
                        <option value="semaforo">semaforo</option>
                        <option value="boca de incendio">boca de incendio</option>
                        <option value="street sign">street sign</option>
                        <option value="señal de alto">señal de alto</option>
                        <option value="parquimetro">parquimetro</option>
                        <option value="banco">banco</option>
                        <option value="pájaro">pájaro</option>
                        <option value="gato">gato</option>
                        <option value="perro">perro</option>
                        <option value="caballo">caballo</option>
                        <option value="oveja">oveja</option>
                        <option value="vaca">vaca</option>
                        <option value="elefante">elefante</option>
                        <option value="oso">oso</option>
                        <option value="zebra">zebra</option>
                        <option value="girafa">girafa</option>
                        <option value="sombrero">sombrero</option>
                        <option value="mochila">mochila</option>
                        <option value="paraguas">paraguas</option>
                        <option value="zapato">zapato</option>
                        <option value="lentes">lentes</option>
                        <option value="bolso de mano">bolso de mano</option>
                        <option value="tie">tie</option>
                        <option value="maleta">maleta</option>
                        <option value="disco volador">disco volador</option>
                        <option value="esquís">esquís</option>
                        <option value="patineta de nieve">patineta de nieve</option>
                        <option value="pelota de deportes">pelota de deportes</option>
                        <option value="cometa">cometa</option>
                        <option value="bat de béisbol">bat de béisbol</option>
                        <option value="guante de béisbol">guante de béisbol</option>
                        <option value="patineta">patineta</option>
                        <option value="tabla de surf">tabla de surf</option>
                        <option value="raqueta de tennis">raqueta de tennis</option>
                        <option value="botella">botella</option>
                        <option value="lámina">lámina</option>
                        <option value="copa de vino">copa de vino</option>
                        <option value="taza">taza</option>
                        <option value="tenedor">tenedor</option>
                        <option value="cuchillo">cuchillo</option>
                        <option value="cuchara">cuchara</option>
                        <option value="bol">bol</option>
                        <option value="platano">platano</option>
                        <option value="manzana">manzana</option>
                        <option value="sandwich">sandwich</option>
                        <option value="naranja">naranja</option>
                        <option value="brocoli">brocoli</option>
                        <option value="zanahoria">zanahoria</option>
                        <option value="hot dog">hot dog</option>
                        <option value="pizza">pizza</option>
                        <option value="dona">dona</option>
                        <option value="pastel">pastel</option>
                        <option value="silla">silla</option>
                        <option value="sofá">sofá</option>
                        <option value="planta en maceta">planta en maceta</option>
                        <option value="cama">cama</option>
                        <option value="espejo">espejo</option>
                        <option value="comedor">comedor</option>
                        <option value="ventana">ventana</option>
                        <option value="escritorio">escritorio</option>
                        <option value="baño">baño</option>
                        <option value="puerta">puerta</option>
                        <option value="televisión">televisión</option>
                        <option value="laptop">laptop</option>
                        <option value="mouse">mouse</option>
                        <option value="remoto">remoto</option>
                        <option value="teclado">teclado</option>
                        <option value="celular">celular</option>
                        <option value="microondas">microondas</option>
                        <option value="horno">horno</option>
                        <option value="tostador">tostador</option>
                        <option value="sink">sink</option>
                        <option value="refrigerador">refrigerador</option>
                        <option value="licuadora">licuadora</option>
                        <option value="libro">libro</option>
                        <option value="reloj">reloj</option>
                        <option value="florero">florero</option>
                        <option value="tijeras">tijeras</option>
                        <option value="oso de peluche">oso de peluche</option>
                        <option value="secador de pelo">secador de pelo</option>
                        <option value="cepillo de dientes">cepillo de dientes</option>
                        <option value="cepillo de pelo">cepillo de pelo</option>
                    </select>
                    <label for="conf_video" title="SSD MobileNet v2: 0.3-0.6 (recomendado: 0.4)">Umbral:</label>
                    <input type="number" id="conf_video" value="0.4" min="0" max="1" step="0.05" />
                    <label for="frameStep">Paso frames:</label>
                    <input type="number" id="frameStep" value="1" min="1" />
                    <label for="maxFrames">Maximo frames:</label>
                    <input type="number" id="maxFrames" value="0" min="0" />
                    <label title="Si está activado, se mostrarán los rectángulos de detección sobre el video.">
                        <input type="checkbox" id="visualizeVideo" aria-label="Mostrar rectángulos de detección" />
                        Mostrar rectángulos
                    </label>
                    <button id="btnDetectVideo">Detectar Video</button>
                </div>
                <div class="margin-top-8">
                    <h4>Detecciones (muestras de frames):</h4>
                    <div id="log_video" class="detection-log">(sin datos)</div>
                </div>
                <div id="status_video" class="status margin-top-8" aria-live="polite"></div>
            </section>
            <section id="tab-camera" class="tab-panel" role="tabpanel" aria-labelledby="tabbtn-camera">
                <div>
                    <label for="cameraUrl">Camera URL (IP camera):</label>
                    <input type="url" id="cameraUrl" placeholder="http://ip:port/video" />
                </div>
                <div class="margin-top-8">
                    <label for="classSelect_camera" class="classLabel" id="classLabel_camera">Clase:</label>
                    <select id="classSelect_camera" class="classSelect">
                        <option value="all">Todas</option>
                        <option value="persona">persona</option>
                        <option value="bicicleta">bicicleta</option>
                        <option value="automovil">automovil</option>
                        <option value="motocicleta">motocicleta</option>
                        <option value="avion">avion</option>
                        <option value="autobus">autobus</option>
                        <option value="tren">tren</option>
                        <option value="camion">camion</option>
                        <option value="barco">barco</option>
                        <option value="semaforo">semaforo</option>
                        <option value="boca de incendio">boca de incendio</option>
                        <option value="street sign">street sign</option>
                        <option value="señal de alto">señal de alto</option>
                        <option value="parquimetro">parquimetro</option>
                        <option value="banco">banco</option>
                        <option value="pájaro">pájaro</option>
                        <option value="gato">gato</option>
                        <option value="perro">perro</option>
                        <option value="caballo">caballo</option>
                        <option value="oveja">oveja</option>
                        <option value="vaca">vaca</option>
                        <option value="elefante">elefante</option>
                        <option value="oso">oso</option>
                        <option value="zebra">zebra</option>
                        <option value="girafa">girafa</option>
                        <option value="sombrero">sombrero</option>
                        <option value="mochila">mochila</option>
                        <option value="paraguas">paraguas</option>
                        <option value="zapato">zapato</option>
                        <option value="lentes">lentes</option>
                        <option value="bolso de mano">bolso de mano</option>
                        <option value="tie">tie</option>
                        <option value="maleta">maleta</option>
                        <option value="disco volador">disco volador</option>
                        <option value="esquís">esquís</option>
                        <option value="patineta de nieve">patineta de nieve</option>
                        <option value="pelota de deportes">pelota de deportes</option>
                        <option value="cometa">cometa</option>
                        <option value="bat de béisbol">bat de béisbol</option>
                        <option value="guante de béisbol">guante de béisbol</option>
                        <option value="patineta">patineta</option>
                        <option value="tabla de surf">tabla de surf</option>
                        <option value="raqueta de tennis">raqueta de tennis</option>
                        <option value="botella">botella</option>
                        <option value="lámina">lámina</option>
                        <option value="copa de vino">copa de vino</option>
                        <option value="taza">taza</option>
                        <option value="tenedor">tenedor</option>
                        <option value="cuchillo">cuchillo</option>
                        <option value="cuchara">cuchara</option>
                        <option value="bol">bol</option>
                        <option value="platano">platano</option>
                        <option value="manzana">manzana</option>
                        <option value="sandwich">sandwich</option>
                        <option value="naranja">naranja</option>
                        <option value="brocoli">brocoli</option>
                        <option value="zanahoria">zanahoria</option>
                        <option value="hot dog">hot dog</option>
                        <option value="pizza">pizza</option>
                        <option value="dona">dona</option>
                        <option value="pastel">pastel</option>
                        <option value="silla">silla</option>
                        <option value="sofá">sofá</option>
                        <option value="planta en maceta">planta en maceta</option>
                        <option value="cama">cama</option>
                        <option value="espejo">espejo</option>
                        <option value="comedor">comedor</option>
                        <option value="ventana">ventana</option>
                        <option value="escritorio">escritorio</option>
                        <option value="baño">baño</option>
                        <option value="puerta">puerta</option>
                        <option value="televisión">televisión</option>
                        <option value="laptop">laptop</option>
                        <option value="mouse">mouse</option>
                        <option value="remoto">remoto</option>
                        <option value="teclado">teclado</option>
                        <option value="celular">celular</option>
                        <option value="microondas">microondas</option>
                        <option value="horno">horno</option>
                        <option value="tostador">tostador</option>
                        <option value="sink">sink</option>
                        <option value="refrigerador">refrigerador</option>
                        <option value="licuadora">licuadora</option>
                        <option value="libro">libro</option>
                        <option value="reloj">reloj</option>
                        <option value="florero">florero</option>
                        <option value="tijeras">tijeras</option>
                        <option value="oso de peluche">oso de peluche</option>
                        <option value="secador de pelo">secador de pelo</option>
                        <option value="cepillo de dientes">cepillo de dientes</option>
                        <option value="cepillo de pelo">cepillo de pelo</option>
                    </select>
                    <label for="conf_camera" title="SSD MobileNet v2: 0.3-0.6 (recomendado: 0.4)">Umbral:</label>
                    <input type="number" id="conf_camera" value="0.4" min="0" max="1" step="0.05" />
                </div>
                <div class="margin-top-8">
                    <button id="btnStartLive">Iniciar vista en vivo</button>
                    <button id="btnStopLive" disabled>Detener vista en vivo</button>
                </div>
                <div id="status_camera" class="status margin-top-8" aria-live="polite"></div>
                <div id="camera_excerpt" class="margin-top-8" aria-live="polite"></div>
                <div class="margin-top-8">
                    <h4>Detecciones recientes (cámara):</h4>
                    <div id="log_camera" class="detection-log">(sin datos)</div>
                </div>
            </section>
        </div>

        <div class="right">
            <div id="result-panel-image" class="result-panel active">
                <h3>Resultado (Imagen):</h3>
                <img id="resultImage" alt="Resultado de detección" class="result-media" />
                <div class="margin-top-12 hidden">
                    <h4>Respuesta:</h4>
                    <pre id="jsonOut_image"></pre>
                </div>
            </div>

            <div id="result-panel-video" class="result-panel">
                <h3>Resultado (Video):</h3>
                <video id="resultVideo" controls class="result-media result-video"></video>
                <div id="timeline_container" class="timeline-container hidden">
                    <h4>Línea de tiempo (detecciones):</h4>
                    <div id="timeline_bar" class="timeline-bar">
                        <div id="timeline_cursor" class="timeline-cursor"></div>
                    </div>
                    <div id="timeline_info" class="timeline-info"></div>
                </div>
                <div class="margin-top-12 hidden">
                    <h4>Respuesta:</h4>
                    <pre id="jsonOut_video"></pre>
                </div>
                <div id="video_download" class="margin-top-8"></div>
            </div>

            <div id="result-panel-camera" class="result-panel">
                <h3>Vista en vivo (procesado):</h3>
                <img id="liveView" alt="Live processed view" class="live-view" />
                <div class="margin-top-12 hidden">
                    <h4>Respuesta:</h4>
                    <pre id="jsonOut_camera" class="hidden"></pre>
                </div>
            </div>
        </div>
    </main>

    <script src="main.js"></script>
    <script>
        (function () {
            const apiSettings = document.querySelector('.api-settings');
            const btn = document.getElementById('btnOpenApiSettings');
            const panel = document.getElementById('apiSettingsPanel');
            const backdrop = document.getElementById('apiBackdrop');
            const body = document.body;

            function openPanel() {
                apiSettings.classList.add('open');
                panel.classList.remove('hidden');
                panel.style.display = 'block';
                panel.setAttribute('aria-hidden', 'false');
                panel.classList.add('visible');
                backdrop.classList.remove('hidden');
                backdrop.classList.add('visible');
                body.classList.add('menu-open');
            }

            function closePanel() {
                apiSettings.classList.remove('open');
                panel.classList.add('hidden');
                panel.style.display = '';
                panel.setAttribute('aria-hidden', 'true');
                panel.classList.remove('visible');
                backdrop.classList.remove('visible');
                backdrop.classList.add('hidden');
                body.classList.remove('menu-open');
            }

            btn.addEventListener('click', function (e) {
                e.stopPropagation();
                if (apiSettings.classList.contains('open')) {
                    closePanel();
                } else {
                    openPanel();
                }
            });
            backdrop.addEventListener('click', function () { closePanel(); });

            document.addEventListener('click', function (e) {
                if (!apiSettings.contains(e.target) && apiSettings.classList.contains('open')) {
                    closePanel();
                }
            });

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && apiSettings.classList.contains('open')) closePanel();
            });

            panel.addEventListener('click', function (e) { e.stopPropagation(); });
        })();
    </script>
</body>

</html>